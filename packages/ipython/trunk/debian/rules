#!/usr/bin/make -f
# ipython debian/rules file
DEB_PYTHON_SYSTEM = pysupport
PYVERS = $(shell pyversions -vd)

# Make sure the html documentation is not compressed and thus stays usable.
DEB_COMPRESS_EXCLUDE := manual/html/

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/python-distutils.mk
include /usr/share/cdbs/1/rules/patchsys-quilt.mk

# force using of correct version of python during build inside scratchbox
# this is a internal variable from /usr/share/cdbs/1/class/python-distutils.mk, not meant to be used outside
cdbs_python_compile_version=$(PYVERS)
DEB_PYTHON_INSTALL_ARGS_ALL = --no-compile -O0 --install-layout=deb

install/ipython::
	# remove test suite script
	rm $(CURDIR)/debian/ipython/usr/bin/iptest
	# remove documentation
	rm $(CURDIR)/debian/ipython/usr/share/doc/ipython/manual/html/_static/jquery.js
	ln -s /usr/share/javascript/jquery/jquery.js \
		$(CURDIR)/debian/ipython/usr/share/doc/ipython/manual/html/_static/

	# add wrapper scripts for all python versions
	set -e ;\
	firstpyver="" ;\
	for pyvers in $(PYVERS); do \
	    if [ "$${firstpyver}" = "" ]; then \
	        install -m 755 debian/ipython.sh $(CURDIR)/debian/ipython/usr/bin/ipython$$pyvers ;\
	        firstpyver="$$pyvers" ;\
	    else \
	        dh_link /usr/bin/ipython$${firstpyver} /usr/bin/ipython$$pyvers ;\
	    fi ;\
	    dh_link /usr/share/man/man1/ipython.1.gz /usr/share/man/man1/ipython$$pyvers.1.gz ;\
	done

	# change permission on scripts
	chmod a-x $(CURDIR)/debian/ipython/usr/share/doc/ipython/examples/*
	
	# removing bogus usr/IPython directory
	rm -rf $(CURDIR)/debian/ipython/usr/IPython

binary-fixup/ipython::
	rm -rf $(CURDIR)/debian/ipython/usr/share/doc/ipython/extensions

clean::
	find . -name \*.pyo | xargs rm -rf
	find . -name \*.pyc | xargs rm -rf

